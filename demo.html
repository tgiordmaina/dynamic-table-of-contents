<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>Build Table of Contents dynamically in pure JS</title>
    </head>

    <body>

        <nav role='navigation' id="toc"></nav>

        <article id="page_content">
            <h1>Build Table of Contents dynamically in pure JS</h1>
            <h2>With some stuffs</h2>
            <p>And foo bar</p>
            <h2>Test 2</h2>
            <p>aaaaa</p>
            <h3>Test 2.1</h3>
            <h3>Test 2.2</h3>
            <h3>Test 2.3</h3><br/><br/><br/><br/><br/><br/><br/><br/>
            <h2>Test 3</h2><br/><br/><br/><br/><br/><br/><br/>
            <h3>Test 3.1</h3><br/><br/><br/><br/><br/><br/><br/>
            <h3>Test 3.2</h3>
            <h3>Test 3.3</h3><br/><br/><br/><br/><br/><br/><br/>
            <h4>Test 3.3.1</h4><br/><br/><br/><br/><br/>
            <h5>Test 3.3.1.1</h5>
            <h5>Test 3.3.1.2</h5>
            <h5>Test 3.3.1.3</h5>
            <h6>Test 3.3.1.3.1</h6><br/><br/><br/><br/><br/><br/>
            <h4>Test 3.3.2</h4><br/><br/><br/><br/>
        </article>


        <script>

        var el = document.querySelectorAll("#page_content h1, #page_content h2, #page_content h3, #page_content h4, #page_content h5, #page_content h6");
            var sTOC = "";
        for (var i = 0; i < el.length; i++) {
            var sAnchorText = el[i].innerText.replace(/\s\s+/g, ' ').replace(/\s/g, '_').replace(/[^0-9a-z\u00C0-\u017F_]/gi, '').replace(/__+/g, '_');
            el[i].setAttribute('id',sAnchorText);
            sTOC += '<a href="#'+ sAnchorText +'">'+ el[i].innerText +'</a><br/>';
        }
        document.getElementById('toc').innerHTML = sTOC;

        </script>

    </body>

</html>
